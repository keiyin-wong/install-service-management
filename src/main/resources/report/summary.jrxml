<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.21.2.final using JasperReports Library version 6.21.2-8434a0bd7c3bbc37cbf916f2968d35e4b165821a  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="summary" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="c25cf411-8fc3-4f70-b77d-314e4225a255">
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="352"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="642"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="installation_service.jrdax"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="net.sf.jasperreports.export.xls.white.page.background" value="false"/>
	<property name="net.sf.jasperreports.export.xls.ignore.cell.background" value="false"/>
	<property name="net.sf.jasperreports.export.xls.detect.cell.type" value="true"/>
	<property name="net.sf.jasperreports.export.xls.auto.fit.row" value="true"/>
	<parameter name="orderIds" class="java.lang.String">
		<defaultValueExpression><![CDATA["10002,10003"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
o.id AS id,
o.date AS `date`,
COALESCE(SUM(
	CASE
	WHEN s.calculation_type=1 THEN od.final_price * od.quantity
	WHEN s.calculation_type=2 THEN TRUNCATE(ROUND((od.width/304.8),2) * ROUND((od.`height`/304.8),2) * od.final_price, 0)
	ELSE TRUNCATE(ROUND((od.width/304.8),2) * od.final_price, 0)
	END
),0)/100 AS total_price
FROM `order` o
LEFT JOIN `order_detail` od ON o.id = od.order_id
LEFT JOIN `service` s ON s.id = od.service_id
WHERE od.order_id IN ($P!{orderIds})
GROUP BY o.id]]>
	</queryString>
	<field name="id" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="id"/>
		<property name="com.jaspersoft.studio.field.label" value="id"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="order"/>
	</field>
	<field name="date" class="java.sql.Date">
		<property name="com.jaspersoft.studio.field.name" value="date"/>
		<property name="com.jaspersoft.studio.field.label" value="date"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="order"/>
	</field>
	<field name="total_price" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="total_price"/>
		<property name="com.jaspersoft.studio.field.label" value="total_price"/>
	</field>
	<variable name="total" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{total_price}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="30" splitType="Stretch">
			<textField>
				<reportElement x="-20" y="0" width="100" height="30" uuid="28a1f453-c7cd-4725-a3ba-3ce1f45da566"/>
				<textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="80" y="0" width="100" height="30" uuid="dcb44604-6f03-4718-a99e-29f8c707d35b"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("dd-MM-yyyy").format($F{date})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="180" y="0" width="100" height="30" uuid="bc0eae41-ea65-4c84-b90b-ddea87fd4288"/>
				<textFieldExpression><![CDATA[$F{total_price}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="30" splitType="Stretch">
			<textField>
				<reportElement x="180" y="0" width="100" height="30" uuid="61289336-fc8a-40b0-a04a-0efd6c26e887"/>
				<textFieldExpression><![CDATA[$V{total}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
